<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>å¼€å‘æ—¥å¿—03-ç¬¬ä¸€è¡Œä»£ç </title>
      <link href="/2023/02/25/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%9703-%E7%AC%AC%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81/"/>
      <url>/2023/02/25/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%9703-%E7%AC%AC%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ã€æè¦"><a href="#ä¸€ã€æè¦" class="headerlink" title="ä¸€ã€æè¦"></a>ä¸€ã€æè¦</h1><p>åœ¨æœ¬ç« èŠ‚æˆ‘ä»¬å°†åœ¨<code>Qing</code>ä¸Šæ·»åŠ ä¸€äº›åŠŸèƒ½</p><ul><li>å£°æ˜å˜é‡</li><li>å˜é‡çš„æ‰“å°</li><li>ç±»å‹æ¨æ–­</li></ul><p>è€Œåœ¨æœ¬ç« èŠ‚ç»“æŸåï¼Œæˆ‘ä»¬è¦è¾¾æˆçš„ç›®æ ‡åˆ™æ˜¯è®©å¦‚ä¸‹çš„ä»£ç å¯ä»¥åœ¨<code>Qing</code>ä¸Šè¿è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">var name=&quot;Qing&quot;  <br>print name <br>var year = 2023<br>print year <br></code></pre></td></tr></table></figure><h1 id="äºŒã€è¯æ³•åˆ†æ"><a href="#äºŒã€è¯æ³•åˆ†æ" class="headerlink" title="äºŒã€è¯æ³•åˆ†æ"></a>äºŒã€è¯æ³•åˆ†æ</h1><h2 id="2-1ã€è¯æ³•è§„åˆ™å®šä¹‰"><a href="#2-1ã€è¯æ³•è§„åˆ™å®šä¹‰" class="headerlink" title="2.1ã€è¯æ³•è§„åˆ™å®šä¹‰"></a>2.1ã€è¯æ³•è§„åˆ™å®šä¹‰</h2><p>ä¸Šä¸€ç« ï¼Œæˆ‘ä»¬é˜è¿°äº†ä¸€ä¸ªç¼–ç¨‹è¯­è¨€çš„ä¸‰ä¸ªæ¨¡å—ï¼Œè‡ªç„¶å…ˆåˆ°æˆ‘ä»¬é¢å‰çš„å°±æ˜¯ç¬¬ä¸€ä¸ªæ¨¡å—<strong>è¯æ³•åˆ†æå™¨</strong>ï¼Œæƒ³è¦é‡å¤´å®ç°ä¸€ä¸ªè¯æ³•åˆ†æå™¨æ˜¯å¾ˆéš¾çš„äº‹ï¼Œè¿˜å¥½å¸‚é¢ä¸Šè¿™ä¹ˆå¤šçš„ç¼–ç¨‹è¯­è¨€ä¹Ÿä¸æ˜¯å‡­ç©ºå‡ºç°çš„ï¼Œå‰è¾ˆä»¬çš„è¯ç”Ÿä¹Ÿä¾é äº†å¾ˆå¤šå¤„ç†ç›¸å…³å·¥ä½œçš„å·¥å…·ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬å°†ä¼šç”¨åˆ°ä¸€ä¸ªå«åš<a href="%22https://github.com/antlr/antlr4%22">antlr</a>çš„å·¥å…·ï¼Œå®ƒèƒ½å¤Ÿå¤§å¤§åœ°å‡è½»æˆ‘ä»¬å¯¹äºè¯æ³•çš„åˆ†æå·¥ä½œ<br>ç°åœ¨ï¼Œæˆ‘ä»¬å…ˆç”¨<code>antlr</code>æè¿°ä¸€ä¸‹æˆ‘ä»¬çš„è§„åˆ™ï¼Œè¿™äº›è§„åˆ™åŸºæœ¬éƒ½æ˜¯å¾ˆå®¹æ˜“çœ‹æ‡‚çš„ï¼Œä¸è¿‡æˆ‘ä¹Ÿå¤§æ¦‚å†™äº†ä¸€äº›æ³¨é‡Šï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯<code>antlr</code>çš„è§„åˆ™ç¼–å†™å’Œ<code>java</code>ä¸€æ ·æ¯ä¸€è¡Œåéœ€è¦è·Ÿä¸€ä¸ª<code>;</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">// å®šä¹‰è¯­è¨€åç§°<br>grammar Qing;<br><br>// å®šä¹‰è§£æè§„åˆ™<br>// æ ¹è§„åˆ™:æ‰€æœ‰çš„ä»£ç æ–‡æœ¬åªæœ‰`variable`å’Œ`print`ä¸¤ç§ç±»å‹,EOFè¡¨ç¤ºæ–‡ä»¶ç»“æŸ<br>compilationUnit : ( variable | print )* EOF;<br>// å£°æ˜èµ‹å€¼è¯­å¥ï¼Œä¾‹: var a = 5  <br>variable : VARIABLE ID EQUALS value;<br>// æ‰“å°è¯­å¥ï¼Œä¾‹: print a<br>print : PRINT ID ;<br>value : NUMBER | STRING ; //must be NUMBER or STRING value (defined below)<br><br>// ç¬¦å·è§„åˆ™ï¼Œä»£ç åˆ‡å‰²ä¸ºç¬¦å·çš„è§„åˆ™<br>VARIABLE : &#x27;var&#x27; ;<br>PRINT : &#x27;print&#x27; ;<br>EQUALS : &#x27;=&#x27; ;<br>NUMBER : [0-9]+ ; // æ•°å­—<br>STRING : &#x27;&quot;&#x27;.*&#x27;&quot;&#x27; ; // &quot;ä»»æ„å€¼&quot;<br>ID : [a-zA-Z0-9]+ ; // éœ€è¦æ˜¯å­—æ¯å’Œæ•°å­—å€¼<br>WS: [ \t\n\r]+ -&gt; skip ; // ç”¨æ¥è¿‡æ»¤ç©ºè¡Œçš„ç‰¹æ®Šç¬¦å·<br></code></pre></td></tr></table></figure><h2 id="2-2ã€ä»£ç ç”Ÿæˆ"><a href="#2-2ã€ä»£ç ç”Ÿæˆ" class="headerlink" title="2.2ã€ä»£ç ç”Ÿæˆ"></a>2.2ã€ä»£ç ç”Ÿæˆ</h2><p>è§„åˆ™å°±è¿™æ ·è¢«æˆ‘ä»¬å®šä¹‰å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦è¿è¡Œ<code>antlr</code>æ¥å¸®æˆ‘ä»¬ç”ŸæˆJavaä»£ç ï¼Œ<code>antlr</code>æ‰§è¡Œç¨‹åºä½ å¯ä»¥åœ¨å®˜ç½‘æˆ–è€…githubå‘å¸ƒé¡µé¢ä¸‹è½½</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">antlr Qing.g4<br></code></pre></td></tr></table></figure><p>ä¸è¿‡æˆ‘ä»¬æ˜¯ç”¨IDEAæ¥ç¼–å†™è¿™ä¸ªç¨‹åºï¼Œæ›´åŠ æ–¹ä¾¿çš„æ–¹å¼æ˜¯ä½¿ç”¨<code>antlr</code>çš„æ’ä»¶æ¥å¸®æˆ‘ä»¬ç”Ÿæˆjavaä»£ç <br>ç”¨æ’ä»¶çš„æ–¹å¼éœ€è¦é¢å¤–è¿›è¡Œä¸€äº›æ’ä»¶çš„é…ç½®<br><img src="http://rqukz9wi7.bkt.clouddn.com/lan_01.png" alt="æ’ä»¶é…ç½®.png"><br>é…ç½®å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ç”Ÿæˆä»£ç äº†ï¼Œæ‰§è¡Œ<code>Generate ANTLR Recognizer</code>å<code>antlr</code>ä¼šåœ¨æŒ‡å®šç›®å½•ç”Ÿæˆå¾ˆå¤šç±»ï¼Œè¿™äº›ä»£ç å¯ä»¥æ”¾åœ¨é‚£é‡Œæš‚æ—¶ä¸è¦ç®¡ï¼Œæˆ‘ä»¬æ¥æ£€éªŒä¸€ä¸‹æˆ‘ä»¬å®šä¹‰çš„è§„åˆ™æ˜¯å¦æœ‰æ•ˆï¼Œå¯ä»¥ä¾ç…§ä¸‹å›¾æ“ä½œ<br><img src="http://rqukz9wi7.bkt.clouddn.com/lan_02.png" alt="å¯è§†åŒ–è§£ææ ‘.png"><br>è§£ææ ‘æˆåŠŸå±•ç¤ºå‡ºæ¥äº†ï¼Œè¡¨æ˜äº†æˆ‘ä»¬è§„åˆ™æ²¡æœ‰é—®é¢˜</p><h1 id="ä¸‰ã€è§£æã€ç¼–è¯‘ä»¥åŠè¿è¡Œ"><a href="#ä¸‰ã€è§£æã€ç¼–è¯‘ä»¥åŠè¿è¡Œ" class="headerlink" title="ä¸‰ã€è§£æã€ç¼–è¯‘ä»¥åŠè¿è¡Œ"></a>ä¸‰ã€è§£æã€ç¼–è¯‘ä»¥åŠè¿è¡Œ</h1><h2 id="3-1ã€éå†è§£ææ ‘"><a href="#3-1ã€éå†è§£ææ ‘" class="headerlink" title="3.1ã€éå†è§£ææ ‘"></a>3.1ã€éå†è§£ææ ‘</h2><p>æˆ‘ä»¬é€šè¿‡<code>antlr</code>å·¥å…·ç”Ÿæˆäº†å¾ˆå¤šç±»ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹</p><ul><li>QingLexer - å®šä¹‰è§£æè§„åˆ™ã€ç¬¦å·</li><li>QingParser - åŒ…å«æ¯ä¸ªè§„åˆ™çš„è§£æå™¨ã€æ ‡è®°ä¿¡æ¯å’Œå†…éƒ¨ç±»ã€‚</li><li>QingListener - è§£æè®¿é—®èŠ‚ç‚¹ç›‘å¬å™¨ï¼Œç”¨äºæ·»åŠ èŠ‚ç‚¹è®¿é—®çš„å›è°ƒ</li><li>QingBaseListener - QingListenerçš„ç©ºå®ç°</li><li>QingVisitor - è§£ææ ‘è®¿é—®å™¨</li><li>QingBaseVisitor - QingBaseVisitorçš„ç©ºå®ç°</li></ul><p>æˆ‘ä»¬ä¸»è¦æ˜¯ä½¿ç”¨<code>QingBaseListener</code>è¿™ä¸ªç±»æ¥å¸®åŠ©æˆ‘ä»¬å¯¹è§£ææ ‘è¿›è¡Œéå†<br>è¿™é‡Œæˆ‘å†™äº†ä¸€ä¸ªç®€æ˜“çš„ç›‘å¬å™¨æ¥ç›‘å¬èµ‹å€¼è¯­å¥ä»¥åŠæ‰“å°è¯­å¥çš„è§£æï¼Œè¿™é‡Œè¿˜æ²¡æœ‰æ¶‰åŠç¼–è¯‘çš„ç»†èŠ‚ï¼Œä¸è¿‡æˆ‘ä»¬å·²ç»å¯ä»¥é€šè¿‡è¿™ä¸ªç›‘å¬å™¨æŠŠè¾“å…¥ä»£ç é‡Œçš„å„é¡¹ç¬¦å·(<code>Token</code>)ä»¥åŠæ•°å€¼éƒ½æ‹¿åˆ°äº†</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QingTreeWalkListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">QingBaseListener</span> &#123;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * å®šä¹‰ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å</span><br><span class="hljs-comment">   */</span><br>  HashMap&lt;String,String&gt; variableMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>  <br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exitVariable</span><span class="hljs-params">(QingParser.VariableContext ctx)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">TerminalNode</span> <span class="hljs-variable">varName</span> <span class="hljs-operator">=</span> ctx.ID();<br>    <span class="hljs-keyword">final</span> QingParser.<span class="hljs-type">ValueContext</span> <span class="hljs-variable">varValue</span> <span class="hljs-operator">=</span> ctx.value();<br>    <span class="hljs-keyword">if</span>(varName !=<span class="hljs-literal">null</span>)&#123;<br>      <span class="hljs-keyword">if</span>(variableMap.containsKey(varName.getText()))&#123;<br>        log.error(<span class="hljs-string">&quot;ä½ è¦å®šä¹‰å˜é‡&#123;&#125;ï¼Œè¿™ä¸ªå˜é‡å·²ç»å®šä¹‰è¿‡äº†&quot;</span>,varName.getText());<br>        <span class="hljs-keyword">return</span>;<br>      &#125;<br>      variableMap.put(varName.getText(), varValue.getText());<br>      log.info(<span class="hljs-string">&quot;ä½ å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œå˜é‡åä¸º&#123;&#125;ï¼Œå®ƒçš„å€¼ä¸º&#123;&#125;&quot;</span>,varName.getText(),varValue.getText());<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exitPrint</span><span class="hljs-params">(QingParser.PrintContext ctx)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">TerminalNode</span> <span class="hljs-variable">varName</span> <span class="hljs-operator">=</span> ctx.ID();<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">printedVarNotDeclared</span> <span class="hljs-operator">=</span> !variableMap.containsKey(varName.getText());<br>    <span class="hljs-keyword">if</span>(printedVarNotDeclared)&#123;<br>      log.error(<span class="hljs-string">&quot;ä½ è¦æ‰“å°çš„å˜é‡&#123;&#125;ä»æœªå®šä¹‰è¿‡&quot;</span>,varName.getText());<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    log.info(<span class="hljs-string">&quot;ä½ è¦æ‰“å°ä¸€ä¸ªå˜é‡,å˜é‡åä¸º&#123;&#125;,å®é™…å€¼ä¸º&#123;&#125;&quot;</span>,varName.getText(),variableMap.get(varName.getText()));<br>  &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>ç›‘å¬å™¨å®ç°äº†ä¹‹åï¼Œå°±å¯ä»¥å®é™…åœ°ä½¿ç”¨å®ƒäº†</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SyntaxTreeTraverser</span> &#123;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * è§£æä»£ç ï¼Œå¹¶æ‰§è¡Œå›è°ƒå‡½æ•°</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> code</span><br><span class="hljs-comment">   */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parse</span><span class="hljs-params">(String code)</span>&#123;<br>      <span class="hljs-type">CodePointCharStream</span> <span class="hljs-variable">codePointCharStream</span> <span class="hljs-operator">=</span> CharStreams.fromString(code);<br>      <span class="hljs-type">QingLexer</span> <span class="hljs-variable">qingLexer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QingLexer</span>(codePointCharStream);<br>      <span class="hljs-type">CommonTokenStream</span> <span class="hljs-variable">tokenStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonTokenStream</span>(qingLexer);<br>      <span class="hljs-type">QingParser</span> <span class="hljs-variable">qingParser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QingParser</span>(tokenStream);<br>      <span class="hljs-type">QingTreeWalkListener</span> <span class="hljs-variable">qingTreeWalkListener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QingTreeWalkListener</span>();<br>      <span class="hljs-type">QingTreeWalkErrorListener</span> <span class="hljs-variable">qingTreeWalkErrorListener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QingTreeWalkErrorListener</span>();<br>      qingParser.addParseListener(qingTreeWalkListener);<br>      qingParser.addErrorListener(qingTreeWalkErrorListener);<br>      qingParser.compilationUnit();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æˆ‘è¿˜ä¸ºå®ƒå†™äº†ä¸€ä¸ªè§£æå¤±è´¥çš„ç›‘å¬å™¨</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QingTreeWalkErrorListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseErrorListener</span> &#123;<br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">syntaxError</span><span class="hljs-params">(Recognizer&lt;?, ?&gt; recognizer, Object offendingSymbol, <span class="hljs-type">int</span> line, <span class="hljs-type">int</span> charPositionInLine, String msg, RecognitionException e)</span> &#123;<br>    log.error(<span class="hljs-string">&quot;ç¬¬&#123;&#125;è¡Œä¸ç¬¦åˆè¯­æ³•è§„åˆ™,è¯¦æƒ…å¦‚ä¸‹\n&#123;&#125;&quot;</span>,line,msg);<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç°åœ¨å¯ä»¥æŠŠæµ‹è¯•ä»£ç è·‘èµ·æ¥è¯•è¯•äº†ï¼Œæˆ‘å†™äº†ä¸€ä¸ª<code>QingCompiler</code>ä½œä¸ºç¼–è¯‘å™¨çš„å…¥å£ç¨‹åºï¼Œä»–åç»­ä¼šæˆä¸ºç¼–è¯‘å™¨çš„ä¸»ä½“ï¼Œå½“ç„¶å®ƒç°åœ¨åªæ˜¯ä¸ºæˆ‘ä»¬æ¥ç®€å•æµ‹è¯•ä¸€ä¸‹è§£ææ ‘çš„éå†æ•ˆæœ</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QingCompiler</span> &#123;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">QingCompiler</span>().compile(args);<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compile</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> <br>      <span class="hljs-string">&quot;var name=\&quot;Qing\&quot; &quot;</span> +<br>        <span class="hljs-string">&quot;var year = 2023 &quot;</span> +<br>        <span class="hljs-string">&quot;print name &quot;</span> +<br>        <span class="hljs-string">&quot;print year  &quot;</span>;<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">SyntaxTreeTraverser</span>().parse(code);<br>  &#125;<br>  <br>&#125;<br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ä¸‹é¢è¿™æ®µç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">var</span> name=<span class="hljs-string">&quot;Qing&quot;</span>  <br>print name <br><span class="hljs-type">var</span> <span class="hljs-variable">year</span> <span class="hljs-operator">=</span> <span class="hljs-number">2023</span><br>print year <br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">ä½ å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œå˜é‡åä¸ºnameï¼Œå®ƒçš„å€¼ä¸º&quot;Qing&quot;<br>ä½ å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œå˜é‡åä¸ºyearï¼Œå®ƒçš„å€¼ä¸º2023<br>ä½ è¦æ‰“å°ä¸€ä¸ªå˜é‡,å˜é‡åä¸ºname,å®é™…å€¼ä¸º&quot;Qing&quot;<br>ä½ è¦æ‰“å°ä¸€ä¸ªå˜é‡,å˜é‡åä¸ºyear,å®é™…å€¼ä¸º2023<br></code></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜å¯ä»¥è¾“å‡ºè§£æå¼‚å¸¸çš„æƒ…å†µ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">ç¬¬1è¡Œä¸ç¬¦åˆè¯­æ³•è§„åˆ™,è¯¦æƒ…å¦‚ä¸‹<br>mismatched input &#x27;String&#x27; expecting &#123;&lt;EOF&gt;, &#x27;var&#x27;, &#x27;print&#x27;&#125;<br></code></pre></td></tr></table></figure><h2 id="3-2ã€ç”Ÿæˆå­—èŠ‚ç "><a href="#3-2ã€ç”Ÿæˆå­—èŠ‚ç " class="headerlink" title="3.2ã€ç”Ÿæˆå­—èŠ‚ç "></a>3.2ã€ç”Ÿæˆå­—èŠ‚ç </h2><p>æˆ‘ä»¬å·²ç»æˆåŠŸéå†äº†è¯­æ³•è§£ææ ‘ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è¦ç”¨è¿™æ£µæ ‘æ¥å½¢æˆå­—èŠ‚ç æ–‡ä»¶äº†ï¼Œ<code>Qing</code>æ˜¯ä¸€ä¸ªJVMè¯­è¨€ï¼Œæ¢è¨€ä¹‹ï¼Œæˆ‘ä»¬è¦ç”Ÿæˆ<code>.class</code>å­—èŠ‚ç æ–‡ä»¶<br>å¦‚æœä½ å¯¹javaè™šæ‹Ÿæœºæ¯”è¾ƒäº†è§£ï¼Œä½ ä¹Ÿè®¸çŸ¥é“<code>.class</code>æ–‡ä»¶æ˜¯ç”±ä¸€ç»„æŒ‡ä»¤æ„æˆï¼Œè€Œæ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½åŒ…å«ï¼š</p><ul><li>ä¸€ä¸ªå­—èŠ‚é•¿åº¦ã€ä»£è¡¨ç€æŸç§ç‰¹å®šæ“ä½œå«ä¹‰çš„æ•°å­— - æ“ä½œç (Opcode)</li><li>é›¶è‡³å¤šä¸ªä»£è¡¨æ­¤æ“ä½œæ‰€éœ€å‚æ•° - æ“ä½œæ•°(Operands)</li></ul><h3 id="3-2-1ã€ASM"><a href="#3-2-1ã€ASM" class="headerlink" title="3.2.1ã€ASM"></a>3.2.1ã€ASM</h3><p><a href="https://so.csdn.net/so/search?q=ASM&spm=1001.2101.3001.7020">ASM</a>æ˜¯ä¸€ç§é€šç”¨Javaå­—èŠ‚ç æ“ä½œå’Œåˆ†ææ¡†æ¶ã€‚å®ƒå¯ä»¥ç”¨äºä¿®æ”¹ç°æœ‰çš„classæ–‡ä»¶æˆ–åŠ¨æ€ç”Ÿæˆclassæ–‡ä»¶ï¼Œæˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªå·¥å…·æ¥ç”Ÿæˆæˆ‘ä»¬æƒ³è¦çš„å­—èŠ‚ç æ–‡ä»¶</p><h3 id="3-2-2ã€æŒ‡ä»¤ç»„å®šä¹‰"><a href="#3-2-2ã€æŒ‡ä»¤ç»„å®šä¹‰" class="headerlink" title="3.2.2ã€æŒ‡ä»¤ç»„å®šä¹‰"></a>3.2.2ã€æŒ‡ä»¤ç»„å®šä¹‰</h3><p>é€šè¿‡<code>ASM</code>ç”Ÿæˆå­—èŠ‚ç ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†ä»£ç è½¬æ¢ä¸ºä¸€ç»„æŒ‡ä»¤(<code>Instruction</code>)</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* æŒ‡ä»¤æ¥å£</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Instruction</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">apply</span><span class="hljs-params">(MethodVisitor methodVisitor)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* å˜é‡å®šä¹‰æŒ‡ä»¤</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VariableDeclarationInstruction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Instruction</span>, Opcodes &#123;<br>    Variable variable;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">VariableDeclarationInstruction</span><span class="hljs-params">(Variable variable)</span> &#123;<br>        <span class="hljs-built_in">this</span>.variable = variable;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">apply</span><span class="hljs-params">(MethodVisitor mv)</span> &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> variable.getType();<br>        <span class="hljs-keyword">if</span>(type == QingLexer.NUMBER) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">val</span> <span class="hljs-operator">=</span> Integer.parseInt(variable.getValue());<br>            mv.visitIntInsn(SIPUSH,val);<br>            mv.visitVarInsn(ISTORE,variable.getId());<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type == QingLexer.STRING) &#123;<br>            mv.visitLdcInsn(variable.getValue());<br>            mv.visitVarInsn(ASTORE,variable.getId());<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* æ‰“å°å˜é‡æŒ‡ä»¤</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PrintVariableInstruction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Instruction</span>, Opcodes &#123;<br>    Variable variable;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PrintVariableInstruction</span><span class="hljs-params">(Variable variable)</span> &#123;<br>        <span class="hljs-built_in">this</span>.variable = variable;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">apply</span><span class="hljs-params">(MethodVisitor mv)</span> &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> variable.getType();<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> variable.getId();<br>        mv.visitFieldInsn(GETSTATIC, <span class="hljs-string">&quot;java/lang/System&quot;</span>, <span class="hljs-string">&quot;out&quot;</span>, <span class="hljs-string">&quot;Ljava/io/PrintStream;&quot;</span>);<br>        <span class="hljs-keyword">if</span> (type == QingLexer.NUMBER) &#123;<br>            mv.visitVarInsn(ILOAD, id);<br>            mv.visitMethodInsn(INVOKEVIRTUAL, <span class="hljs-string">&quot;java/io/PrintStream&quot;</span>, <span class="hljs-string">&quot;println&quot;</span>, <span class="hljs-string">&quot;(I)V&quot;</span>, <span class="hljs-literal">false</span>);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == QingLexer.STRING) &#123;<br>            mv.visitVarInsn(ALOAD, id);<br>            mv.visitMethodInsn(INVOKEVIRTUAL, <span class="hljs-string">&quot;java/io/PrintStream&quot;</span>, <span class="hljs-string">&quot;println&quot;</span>, <span class="hljs-string">&quot;(Ljava/lang/String;)V&quot;</span>, <span class="hljs-literal">false</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="TODO-åŠ ä¸€äº›è§£é‡Š"><a href="#TODO-åŠ ä¸€äº›è§£é‡Š" class="headerlink" title="TODO:åŠ ä¸€äº›è§£é‡Š"></a>TODO:åŠ ä¸€äº›è§£é‡Š</h3><h3 id="3-2-3ã€æŒ‡ä»¤ç»„è£…"><a href="#3-2-3ã€æŒ‡ä»¤ç»„è£…" class="headerlink" title="3.2.3ã€æŒ‡ä»¤ç»„è£…"></a>3.2.3ã€æŒ‡ä»¤ç»„è£…</h3><p>æˆ‘ä»¬ç›®å‰å®é™…æ˜¯å®ç°äº†ï¼Œå˜é‡çš„å£°æ˜ä»¥åŠå˜é‡çš„æ‰“å°åŠŸèƒ½ï¼Œä¸ºæ­¤æˆ‘ä»¬å…ˆå¼•å…¥ä¸€ä¸ªå®ä½“ï¼Œæ¥è¡¨æ˜æˆ‘ä»¬çš„å˜é‡ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Variable</span> &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;<br>  <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> type;<br>  <span class="hljs-keyword">private</span> String value;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å†å°†ä¹‹å‰çš„ç›‘å¬å™¨è°ƒæ•´ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QingTreeWalkListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">QingBaseListener</span> &#123;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * å®šä¹‰ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å</span><br><span class="hljs-comment">   */</span><br>  Map&lt;String, Variable&gt; variableMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>  Queue&lt;Instruction&gt; instructionsQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;&gt;();<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exitVariable</span><span class="hljs-params">(QingParser.VariableContext ctx)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">TerminalNode</span> <span class="hljs-variable">varName</span> <span class="hljs-operator">=</span> ctx.ID();<br>    <span class="hljs-keyword">final</span> QingParser.<span class="hljs-type">ValueContext</span> <span class="hljs-variable">varValue</span> <span class="hljs-operator">=</span> ctx.value();<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">varType</span> <span class="hljs-operator">=</span> varValue.getStart().getType();<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">varIndex</span> <span class="hljs-operator">=</span> variableMap.size();<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">varTextValue</span> <span class="hljs-operator">=</span> varValue.getText();<br>    <span class="hljs-type">Variable</span> <span class="hljs-variable">var</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Variable</span>(varIndex, varType, varTextValue);<br>    <span class="hljs-keyword">if</span> (variableMap.containsKey(varName.getText())) &#123;<br>      log.error(<span class="hljs-string">&quot;ä½ è¦å®šä¹‰å˜é‡&#123;&#125;ï¼Œè¿™ä¸ªå˜é‡å·²ç»å®šä¹‰è¿‡äº†&quot;</span>, varName.getText());<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    variableMap.put(varName.getText(), <span class="hljs-keyword">var</span>);<br>    instructionsQueue.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">VariableDeclarationInstruction</span>(<span class="hljs-keyword">var</span>));<br>    log.info(<span class="hljs-string">&quot;ä½ å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œå˜é‡åä¸º&#123;&#125;ï¼Œå®ƒçš„å€¼ä¸º&#123;&#125;&quot;</span>, varName.getText(), varValue.getText());<br>  &#125;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exitPrint</span><span class="hljs-params">(QingParser.PrintContext ctx)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">TerminalNode</span> <span class="hljs-variable">varName</span> <span class="hljs-operator">=</span> ctx.ID();<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">printedVarNotDeclared</span> <span class="hljs-operator">=</span> !variableMap.containsKey(varName.getText());<br>    <span class="hljs-keyword">if</span> (printedVarNotDeclared) &#123;<br>      log.error(<span class="hljs-string">&quot;ä½ è¦æ‰“å°çš„å˜é‡&#123;&#125;ä»æœªå®šä¹‰è¿‡&quot;</span>, varName.getText());<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">Variable</span> <span class="hljs-variable">variable</span> <span class="hljs-operator">=</span> variableMap.get(varName.getText());<br>    instructionsQueue.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PrintVariableInstruction</span>(variable));<br>    log.info(<span class="hljs-string">&quot;ä½ è¦æ‰“å°ä¸€ä¸ªå˜é‡,å˜é‡åä¸º&#123;&#125;,å®é™…å€¼ä¸º&#123;&#125;&quot;</span>, varName.getText(), variableMap.get(varName.getText()));<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> Queue&lt;Instruction&gt; <span class="hljs-title function_">getInstructionsQueue</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> instructionsQueue;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>éå†å™¨ä¹Ÿè¡¥å……ä¸€ä¸ªæ–¹æ³•ï¼Œè·å–æŒ‡ä»¤é˜Ÿåˆ—</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è¯­æ³•æ ‘éå†å™¨</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SyntaxTreeTraverser</span> &#123;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * è·å–æŒ‡ä»¤é›†</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> code</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">public</span> Queue&lt;Instruction&gt; <span class="hljs-title function_">getInstructions</span><span class="hljs-params">(String code)</span> &#123;<br>    <span class="hljs-type">CodePointCharStream</span> <span class="hljs-variable">codePointCharStream</span> <span class="hljs-operator">=</span> CharStreams.fromString(code);<br>    <span class="hljs-type">QingLexer</span> <span class="hljs-variable">qingLexer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QingLexer</span>(codePointCharStream);<br>    <span class="hljs-type">CommonTokenStream</span> <span class="hljs-variable">tokenStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonTokenStream</span>(qingLexer);<br>    <span class="hljs-type">QingParser</span> <span class="hljs-variable">qingParser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QingParser</span>(tokenStream);<br>    <span class="hljs-type">QingTreeWalkListener</span> <span class="hljs-variable">qingTreeWalkListener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QingTreeWalkListener</span>();<br>    <span class="hljs-type">QingTreeWalkErrorListener</span> <span class="hljs-variable">qingTreeWalkErrorListener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QingTreeWalkErrorListener</span>();<br>    qingParser.addParseListener(qingTreeWalkListener);<br>    qingParser.addErrorListener(qingTreeWalkErrorListener);<br>    qingParser.compilationUnit();<br>    <span class="hljs-keyword">return</span> qingTreeWalkListener.getInstructionsQueue();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-2-4ã€ç”Ÿæˆå­—èŠ‚ç "><a href="#3-2-4ã€ç”Ÿæˆå­—èŠ‚ç " class="headerlink" title="3.2.4ã€ç”Ÿæˆå­—èŠ‚ç "></a>3.2.4ã€ç”Ÿæˆå­—èŠ‚ç </h3><p>æœ€åå†è°ƒæ•´ä¸€ä¸‹ç¼–è¯‘å™¨çš„ä»£ç ï¼Œç”Ÿæˆclassæ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QingCompiler</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">QingCompiler</span>().compile(args);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compile</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> <br>            <span class="hljs-string">&quot;var name=\&quot;Qing\&quot; &quot;</span> +<br>            <span class="hljs-string">&quot;var year = 2023 &quot;</span> +<br>            <span class="hljs-string">&quot;print name &quot;</span> +<br>            <span class="hljs-string">&quot;print year  &quot;</span>;<br>        <span class="hljs-keyword">final</span> Queue&lt;Instruction&gt; instructions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SyntaxTreeTraverser</span>().getInstructions(code);<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">byte</span>[] byteCode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BytecodeGenerator</span>().generateBytecode(instructions, <span class="hljs-string">&quot;first&quot;</span>);<br>        writeBytecodeToClassFile(<span class="hljs-string">&quot;first.class&quot;</span>, byteCode);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeBytecodeToClassFile</span><span class="hljs-params">(String fileName, <span class="hljs-type">byte</span>[] byteCode)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">OutputStream</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> Files.newOutputStream(Paths.get(fileName));<br>        os.write(byteCode);<br>        os.close();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-3ã€è¿è¡Œç¬¬ä¸€ä¸ªQingä»£ç "><a href="#3-3ã€è¿è¡Œç¬¬ä¸€ä¸ªQingä»£ç " class="headerlink" title="3.3ã€è¿è¡Œç¬¬ä¸€ä¸ªQingä»£ç "></a>3.3ã€è¿è¡Œç¬¬ä¸€ä¸ªQingä»£ç </h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">var name=&quot;Qing&quot;  <br>print name <br>var year = 2023<br>print year <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•æˆåŠŸç”Ÿæˆäº†<code>first.class</code>æ–‡ä»¶ï¼Œå†è¿è¡Œä¸€ä¸‹çœ‹çœ‹</p><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$java</span> first<br><span class="hljs-string">&quot;Qing&quot;</span><br>2023<br></code></pre></td></tr></table></figure><h1 id="å››ã€ç‹¬ç«‹å‡ºæ¥"><a href="#å››ã€ç‹¬ç«‹å‡ºæ¥" class="headerlink" title="å››ã€ç‹¬ç«‹å‡ºæ¥"></a>å››ã€ç‹¬ç«‹å‡ºæ¥</h1><p>ç°åœ¨æˆ‘ä»¬çš„ä»£ç æˆåŠŸè¿è¡Œäº†ï¼Œä¸è¿‡åœ¨å®é™…å†™ä»£ç çš„æ—¶å€™å¯æ²¡åŠæ³•æŠŠä»£ç å†™åœ¨<code>main</code>æ–¹æ³•é‡Œç›´æ¥è·‘ğŸ˜‚ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬è¦æŠŠä»£ç æŠ½ç¦»å‡ºæ¥ï¼Œæ¯ä¸ªä»£ç ç‰‡æ®µåº”è¯¥éƒ½æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶åç¼€æ˜¯ä»€ä¹ˆå‘¢ï¼Œå½“ç„¶å°±æ˜¯<code>qing</code>äº†<br>æˆ‘ä»¬çš„ç¼–è¯‘å™¨ä»£ç ä¹Ÿéœ€è¦æ”¹ä¸€ä¸‹ï¼Œå®ƒéœ€è¦è°ƒæ•´ä¸ºæ¥æ”¶ä¸€ä¸ªæ–‡ä»¶è·¯å¾„</p><ul><li>è°ƒæ•´åçš„ä»£ç <figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QingCompiler</span> &#123;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">QingCompiler</span>().compile(args);<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compile</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">File</span> <span class="hljs-variable">qingFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(args[<span class="hljs-number">0</span>]);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> qingFile.getName();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">fileAbsolutePath</span> <span class="hljs-operator">=</span> qingFile.getAbsolutePath();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> StringUtils.remove(fileName, <span class="hljs-string">&quot;.qing&quot;</span>);<br>    <span class="hljs-keyword">final</span> Queue&lt;Instruction&gt; instructions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SyntaxTreeTraverser</span>().getInstructions(fileAbsolutePath);<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">byte</span>[] byteCode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BytecodeGenerator</span>().generateBytecode(instructions, className);<br>    writeBytecodeToClassFile(fileAbsolutePath, byteCode);<br>  &#125;<br><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeBytecodeToClassFile</span><span class="hljs-params">(String fileName, <span class="hljs-type">byte</span>[] byteCode)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">classFile</span> <span class="hljs-operator">=</span> StringUtils.replace(fileName, <span class="hljs-string">&quot;.qing&quot;</span>, <span class="hljs-string">&quot;.class&quot;</span>);<br>    <span class="hljs-type">OutputStream</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> Files.newOutputStream(Paths.get(classFile));<br>    os.write(byteCode);<br>    os.close();<br>  &#125;<br>  <br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è¯­æ³•æ ‘éå†å™¨</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SyntaxTreeTraverser</span> &#123;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * è·å–æŒ‡ä»¤é›†</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> fileAbsolutePath</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">public</span> Queue&lt;Instruction&gt; <span class="hljs-title function_">getInstructions</span><span class="hljs-params">(String fileAbsolutePath)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-type">CharStream</span> <span class="hljs-variable">charStream</span> <span class="hljs-operator">=</span> CharStreams.fromFileName(fileAbsolutePath);<br>    <span class="hljs-type">QingLexer</span> <span class="hljs-variable">qingLexer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QingLexer</span>(charStream);<br>    <span class="hljs-type">CommonTokenStream</span> <span class="hljs-variable">tokenStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonTokenStream</span>(qingLexer);<br>    <span class="hljs-type">QingParser</span> <span class="hljs-variable">qingParser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QingParser</span>(tokenStream);<br>    <span class="hljs-type">QingTreeWalkListener</span> <span class="hljs-variable">qingTreeWalkListener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QingTreeWalkListener</span>();<br>    <span class="hljs-type">QingTreeWalkErrorListener</span> <span class="hljs-variable">qingTreeWalkErrorListener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QingTreeWalkErrorListener</span>();<br>    qingParser.addParseListener(qingTreeWalkListener);<br>    qingParser.addErrorListener(qingTreeWalkErrorListener);<br>    qingParser.compilationUnit();<br>    <span class="hljs-keyword">return</span> qingTreeWalkListener.getInstructionsQueue();<br>  &#125;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> åŠ¨æ‰‹å†™ç¼–ç¨‹è¯­è¨€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼€å‘æ—¥å¿—02ï¼šé¢„æœŸå·¥ä½œ</title>
      <link href="/2023/02/21/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%9702-%E9%A2%84%E6%9C%9F%E5%B7%A5%E4%BD%9C/"/>
      <url>/2023/02/21/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%9702-%E9%A2%84%E6%9C%9F%E5%B7%A5%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<h2 id="å®Œæˆä¸€ä¸ªç¼–ç¨‹è¯­è¨€éœ€è¦åšä»€ä¹ˆï¼Ÿ"><a href="#å®Œæˆä¸€ä¸ªç¼–ç¨‹è¯­è¨€éœ€è¦åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="å®Œæˆä¸€ä¸ªç¼–ç¨‹è¯­è¨€éœ€è¦åšä»€ä¹ˆï¼Ÿ"></a>å®Œæˆä¸€ä¸ªç¼–ç¨‹è¯­è¨€éœ€è¦åšä»€ä¹ˆï¼Ÿ</h2><p>æˆ‘ä»¬æŠŠæ•´ä¸ªç¼–ç¨‹è¯­è¨€çš„å·¥ä½œæŠ½è±¡ä¸€ä¸‹ï¼Œç¼–ç¨‹è¯­è¨€éœ€è¦å¹²ä»€ä¹ˆï¼Ÿ</p><ul><li>æˆ‘ä»¬åœ¨ä¸€ä¸ªæ–‡æœ¬ä¸­å†™äº†å‡ è¡Œä»£ç ï¼Œç„¶åé€šè¿‡ç¼–è¯‘å™¨å°†å®ƒç¼–è¯‘æˆäº†å­—èŠ‚ç æ–‡ä»¶å»æ‰§è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å·¥ä½œå…¶å®å°±æ˜¯è¦æŠŠæ–‡æœ¬è½¬åŒ–ä¸ºå­—èŠ‚ç ï¼Œè¯´èµ·æ¥å¾ˆè½»æ¾ï¼Œä½†æ˜¯å®é™…ä¸Šéœ€è¦è§£å†³å¾ˆå¤šé—®é¢˜</li></ul><p>åœ¨å®é™…çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†</p><table><thead><tr><th>æ¨¡å—</th><th>è¾“å…¥</th><th>è¾“å‡º</th></tr></thead><tbody><tr><td>è¯æ³•åˆ†æå™¨(Lexer)</td><td>ä»£ç (çº¯æ–‡æœ¬)</td><td>ç¬¦å·ç¾¤(Tokens)</td></tr><tr><td>è§£æå™¨(Parser)</td><td>ç¬¦å·ç¾¤(Tokens)</td><td>æŠ½è±¡è¯­æ³•æ ‘(AST)</td></tr><tr><td>ç¼–è¯‘å™¨(Compiler)</td><td>æŠ½è±¡è¯­æ³•æ ‘(AST)</td><td>å­—èŠ‚ç æ–‡ä»¶</td></tr></tbody></table><p>è¿™å‡ ä¸ªæ¨¡å—æˆ–è®¸ä½ ä»¬è¿˜å¹¶ä¸ç†Ÿæ‚‰ï¼Œè¿™äº›éƒ¨åˆ†æœ‰äº›éœ€è¦æˆ‘ä»¬æ‰‹æ’¸ä»£ç ï¼Œæœ‰äº›åˆ™æ˜¯æœ‰ç°æˆçš„å·¥å…·å¯ä»¥åˆ©ç”¨ï¼Œç›¸å…³çš„æ¦‚å¿µç½‘ä¸Šå¯ä»¥æŸ¥åˆ°å¾ˆå¤šè¯¦ç»†çš„èµ„æ–™ï¼Œæˆ‘ä»¬è¿™è¾¹ä¸ä¼šè¿›è¡Œè¯¦ç»†çš„è§£é‡Šï¼Œå®é™…ä¸Šä½ ä¹Ÿå¹¶ä¸éœ€è¦äº†è§£è¿™äº›ä¸œè¥¿åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œåœ¨æˆ‘ä»¬å®ç°å®ƒçš„æ—¶å€™ï¼Œä½ å°±ä¼šè‡ªç„¶è€Œç„¶åœ°äº†è§£<br>è™½è¯´å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜æ˜¯æœ‰å¿…è¦é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šæ•´ä¸ªè¿‡ç¨‹</p><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><pre class="mermaid">graph LR        A["        Input Code<br /><br />        int x=a*5+2;        "]        B["          Tokens<br /><br />{type,int},          <br />{identifier,x}          <br />{operator,=}          <br />{identifier,a}          <br />{operator,#42;}          <br />{number,5}          <br />{operator,+}          <br />{number,2}          <br />{keyword,;}          "]          A-->|LEXER|B          B-->|PARSER|EQUALS        subgraph Abstract Syntax Tree        EQUALS["="]        VARX["x"]        VARA["a"]        MULTIPLY["#42;"]        PLUS["+"]        FIVE[5]        TWO[2]        EQUALS---PLUS        EQUALS---VARX        PLUS---TWO        PLUS---MULTIPLY        MULTIPLY---FIVE        MULTIPLY---VARA        end</pre><p>è¯æ³•åˆ†æå™¨æ¥å—æ–‡æœ¬è¾“å…¥å¹¶å°†å…¶æ¯ä¸ªè¯æ ‡è®°å‡ºæ¥ï¼Œä»£ç äºæ˜¯å˜æˆäº†ä¸€ä¸ªç¬¦å·åˆ—è¡¨ã€‚ç¬¦å·è¿˜ä¸æœ‰åŠ©äºè¿›ä¸€æ­¥åˆ†æçš„ç±»å‹ç›¸å…³è”ã€‚<br>ç¬¦å·è¢«ä¼ é€’ç»™è§£æå™¨ï¼Œè§£æå™¨è´Ÿè´£å°†ç¬¦å·ç»„ç»‡æˆç§°ä¸º<strong>æŠ½è±¡è¯­æ³•æ ‘çš„</strong>å±‚æ¬¡ç»“æ„ã€‚æ ‘å†³å®šäº†ä»£ç çš„æ‰§è¡Œé¡ºåºã€‚Compiler ç¼–è¯‘å™¨éå†æ ‘å¹¶å°†å…¶æ˜ å°„ä¸ºæœ‰æ•ˆçš„å­—èŠ‚ç æŒ‡ä»¤</p>]]></content>
      
      
      <categories>
          
          <category> åŠ¨æ‰‹å†™ç¼–ç¨‹è¯­è¨€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼€å‘æ—¥å¿—01ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç¼–ç¨‹è¯­è¨€</title>
      <link href="/2023/02/17/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%9701_%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
      <url>/2023/02/17/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%9701_%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘æ‰“ç®—å¼€å§‹ä»é›¶å¼€å§‹ç¼–å†™ä¸€ä¸ªç¼–ç¨‹è¯­è¨€ï¼Œå› ä¸ºæˆ‘çš„ä¸»ç¼–ç¨‹è¯­è¨€æ˜¯Javaï¼Œæ‰€ä»¥æˆ‘æ‰“ç®—åšä¸€ä¸ªç±»ä¼¼kotlinæˆ–è€…scalaçš„jvmè¯­è¨€ï¼Œè¿™æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œé‚£å°±æ˜¯è¿™ä¸ªè¯­è¨€è¯ç”Ÿä¹‹åˆå°±å¯ä»¥è°ƒç”¨å¾ˆå¤šJavaçš„åº“ï¼Œç›¸å½“äºä¸ºå®ƒèµ‹äºˆäº†ä¸€å®šçš„ç”Ÿäº§èƒ½åŠ›ï¼Œå½“ç„¶è¿™ä¸ªè¯­è¨€å¹¶ä¸ä¸€å®šè¦æœ‰å®é™…ä»·å€¼ï¼Œä¸è¿‡åˆ›å»ºè¯­è¨€çš„è¿™ä¸ªè¿‡ç¨‹ä¸€å®šä¼šå¾ˆæœ‰æ„ä¹‰<br>ä¸ºä»€ä¹ˆé€‰æ‹©åšJVMè¯­è¨€ ï¼š</p><ul><li>æˆ‘ç†Ÿæ‚‰Javaï¼Œç”¨Javaæ¥ç¼–å†™æˆ‘ä¼šæ›´åŠ ä¸Šæ‰‹</li><li>JVM è¯­è¨€å¯ä»¥ç›¸äº’æ··åˆï¼Œåƒkotlinä¹Ÿæ˜¯å¯ä»¥è°ƒç”¨javaåº“çš„</li><li>Javaæœ‰äº›æ–¹é¢éœ€è¦ä¼˜åŒ–ï¼Œç›¸å¯¹äºä¸€äº›å…¶å®ƒçš„ç¼–ç¨‹è¯­è¨€ï¼ŒJavaçš„è¯­æ³•ç›¸å¯¹æ›´åŠ è‡ƒè‚¿(è™½ç„¶Javaæ–°ç‰¹æ€§ä¸€ç›´åœ¨æŒç»­å¼•å…¥è¯­æ³•ç³–æ¥æ”¹è¿›è¿™äº›é—®é¢˜)</li></ul><p>ç›®æ ‡æ˜¯åšåˆ°ä»€ä¹ˆç¨‹åº¦ï¼š</p><ul><li>è¿™ä¸ªè¯­è¨€ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶åç¼€</li><li>å¯ä»¥ç¼–å†™å®é™…çš„åº”ç”¨ç¨‹åº</li><li>å¯èƒ½ä¼šé’ˆå¯¹æŸäº›IDEåšä¸€äº›ç‰¹å®šè¯­æ³•é«˜äº®çš„æ”¯æŒæ’ä»¶ï¼Œä½¿å®ƒæ›´åƒæ ·</li><li>å¦‚æœå¯ä»¥åœ¨æŸäº›æ–¹é¢èƒ½æ¯”ç”¨Javaæ¥ç¼–å†™ç¨‹åºæ›´æœ‰æ•ˆç‡é‚£å°±æ›´å¥½äº†</li></ul><p>å¥½äº†ï¼Œç°åœ¨å…ˆç»™è¿™ä¸ªç¼–ç¨‹è¯­è¨€èµ·ä¸ªåå­—å§ï¼Œèµ·åæ€»æ˜¯ä¸€ä»¶å¾ˆå›°éš¾çš„äº‹ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥ç”¨ä¸€äº›å·¥å…·æ¥éšæœºä¸€ä¸ªåå­—å‡ºæ¥ <a href="https://www.namegenerators.me/software-names/678/">https://www.namegenerators.me/software-names/678/</a></p><p>ä¸è¿‡æˆ‘æœ€ç»ˆæ²¡æœ‰è¿™ä¹ˆåšï¼Œå®ƒæœ€ç»ˆå–åå«åšQingï¼Œå› ä¸ºè¿™åªæ˜¯ä¸€ä¸ªç©å…·è¯­è¨€ï¼Œè‚¯å®šä¼šæ¯”å·²ç»å‘å±•äº†å¾ˆä¹…çš„è¯­è¨€è€å‰è¾ˆè½»é‡ï¼Œå¦å¤–å®ƒè®¾è®¡ä¹‹åˆä¹Ÿæ˜¯å¸Œæœ›ç”¨èµ·æ¥å¾ˆè½»ä¾¿</p>]]></content>
      
      
      <categories>
          
          <category> åŠ¨æ‰‹å†™ç¼–ç¨‹è¯­è¨€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åç«¯ </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
